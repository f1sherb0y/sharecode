{$DOMAIN:localhost} {
	# Automatic HTTPS with Let's Encrypt
	# Caddy will automatically obtain and renew SSL certificates
	
	# Logging (optional)
	log {
		output file /data/access.log
		format json
	}

	# Enable compression
	encode gzip zstd

	# Security headers
	header {
		# Enable HSTS
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		# Prevent clickjacking
		X-Frame-Options "SAMEORIGIN"
		# Prevent MIME sniffing
		X-Content-Type-Options "nosniff"
		# Enable XSS protection
		X-XSS-Protection "1; mode=block"
		# Remove Server header
		-Server
	}

	# WebSocket endpoint for collaborative editing
	@websocket {
		path /api/ws
		header Connection *Upgrade*
		header Upgrade websocket
	}
	reverse_proxy @websocket server:3001 {
		# WebSocket-specific settings
		header_up Host {host}
		header_up X-Real-IP {remote_host}
		header_up X-Forwarded-For {remote_host}
		header_up X-Forwarded-Proto {scheme}
	}

	# API endpoints
	handle /api/* {
		reverse_proxy server:3001 {
			header_up Host {host}
			header_up X-Real-IP {remote_host}
			header_up X-Forwarded-For {remote_host}
			header_up X-Forwarded-Proto {scheme}
		}
	}

	# Frontend (React app served by nginx)
	handle {
		reverse_proxy frontend:80 {
			header_up Host {host}
			header_up X-Real-IP {remote_host}
			header_up X-Forwarded-For {remote_host}
			header_up X-Forwarded-Proto {scheme}
		}
	}
}
